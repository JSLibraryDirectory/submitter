/*! jQuery Submitter Plugin v0.1.0 | (c) 2014 Fengyuan Chen */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(window.jQuery)}(function(a){"use strict";function b(b,c){this.$form=a(b),this.init(c)}b.defaults={resetAfterDone:!1,messages:{start:"Submit start.",done:"Submit done.",fail:"Submit fail.",end:"Submit end."},ajaxOptions:{cache:!1,dataType:"json"},isValidated:function(){return!0},start:function(){console.log(this.messages.start)},done:function(){console.log(this.messages.done)},fail:function(){console.log(this.messages.fail)},end:function(){console.log(this.messages.end)}},b.prototype={constructor:b,support:{formData:!!window.FormData},textStatus:{start:"start",done:"success",fail:"error",end:"complete"},init:function(c){var d={beforeSend:a.proxy(this.start,this),success:a.proxy(this.done,this),error:a.proxy(this.fail,this),complete:a.proxy(this.end,this)},e={type:this.$form.attr("method")||"get",url:this.$form.attr("action")||""},f=this.$form.find(":submit"),g=this.$form.find(":reset");c=a.isPlainObject(c)?c:{},this.defaults=a.extend(!0,{},b.defaults,c),this.ajaxOptions=a.extend({},e,this.defaults.ajaxOptions,d),this.$form.find(":file").length>0&&(this.requireUpload=!0,this.support.formData||this.initIframe()),0===f.length&&(f=a('<button type="submit" style="display:none;"></button>'),this.$form.append(f)),0===g.length&&(g=a('<button type="reset" style="display:none;">Reset</button>'),this.$form.append(g)),this.$submit=f,this.$reset=g,this.active()},active:function(){var a=this;this.$form.submit(function(){return a.defaults.isValidated()?!a.requireUpload||a.support.formData?(a.submit(),!1):void a.start(null):!1})},distory:function(){this.$form.off("submit"),this.$iframe.off("load"),this.$form=null,this.$iframe.remove(),this.$iframe=null},start:function(b){a.isFunction(this.defaults.start)&&this.defaults.start(),a.isFunction(this.defaults.ajaxOptions.beforeSend)&&this.defaults.ajaxOptions.beforeSend(b)},done:function(b,c,d){a.isFunction(this.defaults.done)&&this.defaults.done(b),a.isFunction(this.defaults.ajaxOptions.success)&&this.defaults.ajaxOptions.success(b,c,d),this.defaults.resetAfterDone&&this.$reset.click()},fail:function(b,c,d){a.isFunction(this.defaults.fail)&&this.defaults.fail(),a.isFunction(this.defaults.ajaxOptions.error)&&this.defaults.ajaxOptions.error(b,c,d)},end:function(b,c){a.isFunction(this.defaults.end)&&this.defaults.end(),a.isFunction(this.defaults.ajaxOptions.complete)&&this.defaults.ajaxOptions.complete(b,c)},submit:function(){var b=a.extend({},this.ajaxOptions);this.support.formData?(b.data=new FormData(this.$form[0]),b.processData=!1,b.contentType=!1):b.data=this.$form.serialize(),a.ajax(b)},initIframe:function(){var b="submitter-"+Math.random().toString().replace("0.",""),c=a('<iframe name="'+b+'" style="display:none;"></iframe>'),d=this;c.on("load",function(){var b,c,e;try{c=this.contentWindow,e=this.contentDocument,e=e?e:c.document,b=e?e.body.innerText:null,b="string"==typeof b?a.parseJSON(b):b}catch(f){d.fail(null,"fail",f.message)}b&&(a.isPlainObject(b)?d.done(b,"done",null):d.fail(null,"fail",d.defaults.messages.fail),d.end(null,"end"))}),this.defaults.ajaxOptions.type&&this.$form.attr("method",this.defaults.ajaxOptions.type),this.$form.attr("target",b).after(c),this.$iframe=c}},a.fn.submitter=function(c){return this.each(function(){var d=a(this),e=d.data("submitter");return"string"==typeof c&&a.isFunction(e[c])?void e[c]():void d.data("submitter",new b(this,c))})},a.fn.submitter.Constructor=b,a(function(){a("form[data-submitter]").submitter()})});